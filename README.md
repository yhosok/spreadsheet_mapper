# Googleスプレッドシート 形式変換スクリプト

このプロジェクトは、Googleスプレッドシート上で特定のCSVデータ（フォーマットA）を、定義されたマッピングに基づき別のCSV形式（フォーマットB）へ変換するGoogle Apps Scriptです。

## 機能概要

- **フォーマットA**のデータを**フォーマットB**に自動変換
- Googleスプレッドシート上でのワンクリック実行
- 項目マッピングの柔軟な設定
- エラーハンドリングとユーザー通知

## ファイル構成

```
spreadsheet_mapper/
├── README.md                 # このファイル
├── all-in-one.gs            # 統合版スクリプト（推奨）
├── src/
│   ├── main.gs              # メイン処理
│   ├── mapping.gs           # マッピング処理
│   ├── utils.gs             # ユーティリティ関数
│   └── menu.gs              # カスタムメニュー設定
├── sample/
│   └── sample_data.csv      # サンプルデータ
└── docs/
    └── setup_guide.md       # セットアップガイド
```

## 導入手順

### 1. Googleスプレッドシートの準備

1. 新しいGoogleスプレッドシートを作成します
2. 以下の名前でシートを作成します：
   - `INPUT`
   - `項目マッピング`

### 2. Google Apps Scriptの設定

#### 方法1: 統合版ファイルを使用（推奨）

1. Googleスプレッドシートで「拡張機能」→「Apps Script」を選択
2. `all-in-one.gs`ファイルの内容を全てコピーしてApps Scriptエディタに貼り付け
3. ファイルを保存

#### 方法2: 個別ファイルを使用

1. Googleスプレッドシートで「拡張機能」→「Apps Script」を選択
2. `src/`フォルダ内の各`.gs`ファイルの内容をApps Scriptエディタにコピー
3. ファイルを保存

### 3. 項目マッピングシートの設定

`項目マッピング`に以下の形式でマッピングを定義します。**必ずヘッダー行を含めてください。**

| A列（フォーマットA項目名） | B列（フォーマットB項目名） |
|:-------------------------|:-------------------------|
| フォーマットA項目名        | フォーマットB項目名        |
| 出荷日                   | shipping_date            |
| 顧客名                   | customer_name            |
| 商品コード               | product_code             |
| 数量                     | quantity                 |

### 4. シート名のカスタマイズ（オプション）

デフォルトのシート名を変更したい場合は、スクリプト内の設定を変更できます：

- **INPUT** → 任意の名前
- **項目マッピング** → 任意の名前  
- **OUTPUT** → 任意の名前

詳細は「カスタマイズ」セクションをご確認ください。

## 使用方法

### 1. データの準備

1. `INPUT`に変換したいデータを貼り付けます
   - 1行目：ヘッダー行（項目名）
   - 2行目以降：実際のデータ

### 2. 変換の実行

1. スプレッドシートのメニューから「カスタムメニュー」→「フォーマット変換実行」を選択
2. 処理完了のメッセージが表示されるまで待機
3. `OUTPUT`に変換結果が出力されます

### 3. 結果の確認

- `OUTPUT`が自動生成されます
- 1行目：フォーマットBの項目名
- 2行目以降：変換されたデータ

## サンプルデータ

`sample/sample_data.csv`にサンプルデータを用意しています。テスト用にご利用ください。

### フォーマットAサンプル

```csv
出荷日,顧客名,商品コード,数量,単価
2024-01-15,株式会社A,PROD001,10,1000
2024-01-16,株式会社B,PROD002,5,2000
```

### フォーマットBサンプル（変換後）

```csv
shipping_date,customer_name,product_code,quantity
2024-01-15,株式会社A,PROD001,10
2024-01-16,株式会社B,PROD002,5
```

## エラーハンドリング

以下の場合にエラーメッセージが表示されます：

- 必要なシートが存在しない場合
- INPUTにデータが存在しない場合
- 項目マッピングの設定に不備がある場合

## トラブルシューティング

### 「権限が必要です」と表示される場合

1. Apps Scriptの初回実行時に権限の許可が必要です
2. 「権限を確認」をクリックし、Googleアカウントでログイン
3. 「詳細」→「安全ではないページに移動」→「許可」を選択

### 変換が正しく動作しない場合

1. 項目マッピングの設定を確認
2. INPUTのヘッダー行が正しく設定されているか確認
3. データに空白行や特殊文字が含まれていないか確認

## カスタマイズ

### シート名の変更

デフォルトのシート名を変更する場合は、`all-in-one.gs`内の以下の部分を編集してください：

```javascript
// シート名の設定（カスタマイズ可能）
const SHEET_NAMES = {
  INPUT: 'INPUT',      // 入力シート名
  MAPPING: '項目マッピング',  // マッピングシート名
  OUTPUT: 'OUTPUT'      // 出力シート名
};
```

### 新しい項目を追加する場合

1. `項目マッピング`に新しい行を追加
2. A列にフォーマットAの項目名、B列にフォーマットBの項目名を入力
3. スクリプトを再実行

### データ変換ロジックを変更する場合

統合版では`convertData`関数、個別版では`src/mapping.gs`の`transformData`関数を編集してください。

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## サポート

質問や問題がある場合は、プロジェクトの管理者にお問い合わせください。
