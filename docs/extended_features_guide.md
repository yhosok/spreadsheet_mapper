# 拡張機能 使用ガイド

## 📋 概要

このガイドでは、Googleスプレッドシート フォーマット変換ツールの拡張機能について詳しく説明します。

## 🚀 拡張機能一覧

### 1. 複数フィールド結合（CONCAT）

#### 機能
複数のINPUTフィールドを1つのOUTPUTフィールドに結合する機能です。

#### 使用方法
```
フィールド1+フィールド2+フィールド3
```

#### 設定例
| フォーマットA項目名 | フォーマットB項目名 | 変換タイプ | 設定値 |
|-------------------|-------------------|-----------|--------|
| 住所1+住所2+住所3 | full_address | CONCAT | 、 |
| 姓+名 | full_name | CONCAT | " " |
| 年+月+日 | date_combined | CONCAT | / |

#### 結果例
- **住所結合**: `東京都` + `新宿区` + `1-1-1` → `東京都、新宿区、1-1-1`
- **氏名結合**: `田中` + `太郎` → `田中 太郎`
- **日付結合**: `2024` + `01` + `15` → `2024/01/15`

### 2. 固定値設定（FIXED）

#### 機能
特定のフィールドに固定値を設定する機能です。

#### 使用方法
```
[FIXED:値]      # 値を直接指定
[FIXED]         # 設定値列で指定
```

#### 設定例
| フォーマットA項目名 | フォーマットB項目名 | 変換タイプ | 設定値 |
|-------------------|-------------------|-----------|--------|
| [FIXED:処理済み] | status | FIXED | |
| [FIXED] | created_by | FIXED | システム自動 |
| [FIXED:2024-07-08] | created_date | FIXED | |

#### 結果例
- **ステータス**: 全行に `処理済み` が設定
- **作成者**: 全行に `システム自動` が設定
- **作成日**: 全行に `2024-07-08` が設定

### 3. 通常マッピング（NORMAL）

#### 機能
1つのINPUTフィールドを1つのOUTPUTフィールドにマッピングする基本機能です。

#### 設定例
| フォーマットA項目名 | フォーマットB項目名 | 変換タイプ | 設定値 |
|-------------------|-------------------|-----------|--------|
| 出荷日 | shipping_date | NORMAL | |
| 顧客名 | customer_name | NORMAL | |

## 📊 実践例

### サンプルデータ
```csv
出荷日,顧客名,住所1,住所2,住所3,商品コード,数量,備考
2024-01-15,株式会社A,東京都,新宿区,1-1-1,PROD001,10,通常出荷
2024-01-16,株式会社B,大阪府,大阪市,中央区2-2-2,PROD002,5,急ぎ
```

### マッピング設定
```csv
フォーマットA項目名,フォーマットB項目名,変換タイプ,設定値
出荷日,shipping_date,NORMAL,
顧客名,customer_name,NORMAL,
住所1+住所2+住所3,full_address,CONCAT,
商品コード,product_code,NORMAL,
数量,quantity,NORMAL,
[FIXED:処理済み],status,FIXED,
[FIXED],created_by,FIXED,システム自動
備考,notes,NORMAL,
```

### 変換結果
```csv
shipping_date,customer_name,full_address,product_code,quantity,status,created_by,notes
2024-01-15,株式会社A,東京都新宿区1-1-1,PROD001,10,処理済み,システム自動,通常出荷
2024-01-16,株式会社B,大阪府大阪市中央区2-2-2,PROD002,5,処理済み,システム自動,急ぎ
```

## 🔧 高度な使用例

### 1. 複雑な住所結合
```csv
都道府県+市区町村+町名+番地+建物名,full_address,CONCAT,
```
結果: `東京都新宿区西新宿1-1-1新宿ビル`

### 2. 日時の結合
```csv
年+月+日+時+分,datetime_combined,CONCAT,/
```
結果: `2024/01/15/10/30`

### 3. 条件付き固定値
```csv
[FIXED:重要],priority,FIXED,
```
特定条件のデータに対して優先度を設定

### 4. 複数の固定値設定
```csv
[FIXED:未処理],status,FIXED,
[FIXED],created_by,FIXED,システム
[FIXED],updated_by,FIXED,
[FIXED:2024-07-08],created_date,FIXED,
```

## ⚠️ 注意事項

### 1. 結合フィールドの制限
- 最低2つ以上のフィールドが必要
- 存在しないフィールドは無視される
- 空の値は結合に含まれない

### 2. 固定値の制限
- 固定値は文字列として扱われる
- 改行文字は使用できない
- 特殊文字は使用可能

### 3. 区切り文字の注意
- 区切り文字未指定の場合は、フィールドが直接結合される
- 空白を区切り文字にする場合は、設定値列に `" "` を記入

## 🔍 エラー対応

### よくあるエラーと解決法

#### 1. 「CONCATタイプでは複数のソースフィールドが必要です」
- **原因**: 結合フィールドが1つしか指定されていない
- **解決**: `+` で複数フィールドを結合する

#### 2. 「FIXEDタイプでは固定値の設定が必要です」
- **原因**: 固定値が設定されていない
- **解決**: `[FIXED:値]` 形式で値を指定するか、設定値列に記入

#### 3. 「以下の項目が入力シートに見つかりません」
- **原因**: 結合フィールドの一部が入力シートに存在しない
- **解決**: 入力シートのヘッダー名を確認し、マッピングを修正

## 💡 Tips

### 1. 効率的な設定方法
- 変換タイプは省略可能（自動判定される）
- 基本的なマッピングは2列形式で十分
- 拡張機能が必要な場合のみ4列形式を使用

### 2. デバッグ方法
- 「マッピング検証」で設定内容を確認
- 「変換プレビュー」で結果を事前確認
- 小さなデータセットでテストしてから本番実行

### 3. パフォーマンスの向上
- 不要な固定値設定は避ける
- 結合フィールドは必要最小限に抑える
- 大量データの場合は分割処理を検討

## 📝 まとめ

拡張機能を使用することで、より柔軟で高度なデータ変換が可能になります。基本的な使用方法をマスターした後、段階的に拡張機能を活用していくことをお勧めします。

ご質問やサポートが必要な場合は、管理者までお問い合わせください。
