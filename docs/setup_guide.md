# セットアップガイド

## 1. Googleスプレッドシートの準備

### 1.1 新しいスプレッドシートの作成

1. [Google Sheets](https://sheets.google.com)にアクセス
2. 「空白」を選択して新しいスプレッドシートを作成
3. スプレッドシートに分かりやすい名前を付ける（例：「フォーマット変換ツール」）

### 1.2 必要なシートの作成

以下の3つのシートを作成します：

#### A. フォーマットA入力シート

1. シート名を「フォーマットA入力シート」に変更
2. A1セルから、変換したいデータのヘッダー行を入力
3. A2セル以降に実際のデータを入力

**例：**
```
A1: 出荷日      B1: 顧客名        C1: 商品コード    D1: 数量    E1: 単価
A2: 2024-01-15  B2: 株式会社A     C2: PROD001      D2: 10      E2: 1000
A3: 2024-01-16  B3: 株式会社B     C3: PROD002      D3: 5       E3: 2000
```

#### B. 項目マッピングシート

1. 新しいシートを追加し、名前を「項目マッピングシート」に変更
2. A列にフォーマットAの項目名、B列にフォーマットBの項目名を入力

**例：**
```
A1: 出荷日          B1: shipping_date
A2: 顧客名          B2: customer_name
A3: 商品コード      B3: product_code
A4: 数量           B4: quantity
```

⚠️ **重要な注意事項：**
- フォーマットB項目名（B列）は英数字とアンダースコア（_）のみ使用
- 項目名の重複は避けてください
- 空行は作らないでください

## 2. Google Apps Scriptの設定

### 2.1 Apps Scriptエディタを開く

1. Googleスプレッドシートで「拡張機能」→「Apps Script」を選択
2. 新しいタブでApps Scriptエディタが開きます

### 2.2 スクリプトファイルの作成

#### デフォルトファイルの削除
1. 「Code.gs」ファイルが既に存在する場合は削除

#### 新しいファイルの作成
以下の順序で4つのファイルを作成します：

1. **main.gs** - `src/main.gs`の内容をコピー
2. **mapping.gs** - `src/mapping.gs`の内容をコピー
3. **utils.gs** - `src/utils.gs`の内容をコピー
4. **menu.gs** - `src/menu.gs`の内容をコピー

#### ファイル作成手順：
1. 「+」ボタンまたは「ファイル」→「新規」→「スクリプト」を選択
2. ファイル名を入力（例：main.gs）
3. 対応するソースコードをコピー＆ペースト
4. Ctrl+S（Cmd+S）で保存

### 2.3 権限の設定

1. 「実行」ボタンをクリックして初回実行
2. 「権限を確認」ダイアログが表示される
3. Googleアカウントを選択
4. 「詳細」→「安全ではないページに移動」を選択
5. 「許可」をクリック

## 3. 初回実行と確認

### 3.1 スプレッドシートに戻る

1. Apps Scriptエディタからスプレッドシートのタブに戻る
2. ページを再読み込み（F5 または Ctrl+R）

### 3.2 カスタムメニューの確認

スプレッドシートの上部メニューに「📊 フォーマット変換ツール」が表示されることを確認

### 3.3 動作テスト

1. 「📊 フォーマット変換ツール」→「📝 シート作成ヘルプ」を選択
2. ヘルプメッセージが表示されれば正常にセットアップ完了

## 4. サンプルデータでのテスト

### 4.1 サンプルデータの準備

`sample/sample_data.csv`の内容を使用してテストを実行：

1. フォーマットA入力シートにサンプルデータをコピー
2. 項目マッピングシートに以下を設定：

```
A1: 出荷日      B1: shipping_date
A2: 顧客名      B2: customer_name
A3: 商品コード  B3: product_code
A4: 数量       B4: quantity
```

### 4.2 テスト実行

1. 「✅ マッピング検証」を実行→成功メッセージを確認
2. 「👀 変換プレビュー」を実行→プレビュー結果を確認
3. 「🔄 フォーマット変換実行」を実行
4. 「フォーマットB出力シート」が作成され、変換データが表示されることを確認

## 5. トラブルシューティング

### 5.1 よくある問題と解決方法

#### 「シートが見つかりません」エラー
- シート名が正確に設定されているか確認
- 全角・半角、スペースの有無を確認

#### 「権限エラー」が発生する
- Apps Scriptの権限設定を再実行
- ブラウザのポップアップブロックを無効化

#### 変換結果が期待と異なる
- 項目マッピングシートの設定を確認
- フォーマットA入力シートのヘッダー行が正しいか確認

#### メニューが表示されない
- ページを再読み込み
- Apps Scriptで`onOpen`関数を手動実行

### 5.2 ログの確認方法

1. Apps Scriptエディタで「表示」→「ログ」を選択
2. エラーの詳細情報を確認
3. 必要に応じてコンソールログも確認

## 6. 運用開始

セットアップが完了したら、実際のデータでの運用を開始できます：

1. 実際のフォーマットAデータを準備
2. 必要に応じて項目マッピングを調整
3. 定期的な変換作業の実行

## 7. メンテナンス

### 7.1 定期的な確認事項

- スプレッドシートの容量制限
- Apps Scriptの実行時間制限
- データの形式変更への対応

### 7.2 バックアップ

- 重要なデータは定期的にダウンロード
- Apps Scriptのコードをローカルに保存

---

このセットアップガイドに従って設定を完了すれば、フォーマット変換ツールをすぐに使用開始できます。
